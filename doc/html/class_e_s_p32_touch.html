<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP32Touch: ESP32Touch Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ESP32Touch
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">ESP32 touch button driver with async callback interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="class_e_s_p32_touch-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ESP32Touch Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>ESP32 touch button driver with async callback interface.  
 <a href="class_e_s_p32_touch.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="esp32__touch_8hpp_source.html">esp32_touch.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4d71a331ef00f6853eb2285a0afd9763"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#a4d71a331ef00f6853eb2285a0afd9763">configure_input</a> (const int input_number, const uint8_t threshold_percent, <a class="el" href="esp32__touch_8hpp.html#a57055132e8b5e6931a9475fa451990ae">CallbackT</a> callback=nullptr)</td></tr>
<tr class="memdesc:a4d71a331ef00f6853eb2285a0afd9763"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure input pin as a touch input, set threshold value and register the required user callback called when pin is touched.  <a href="#a4d71a331ef00f6853eb2285a0afd9763">More...</a><br /></td></tr>
<tr class="separator:a4d71a331ef00f6853eb2285a0afd9763"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d6f0e4afbb6f98f753ec02d71bd4ec4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#a3d6f0e4afbb6f98f753ec02d71bd4ec4">calibrate_thresholds</a> ()</td></tr>
<tr class="memdesc:a3d6f0e4afbb6f98f753ec02d71bd4ec4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Force a sensor re-calibration.  <a href="#a3d6f0e4afbb6f98f753ec02d71bd4ec4">More...</a><br /></td></tr>
<tr class="separator:a3d6f0e4afbb6f98f753ec02d71bd4ec4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25a1bb0d553ca66879253f21bc9e402c"><td class="memItemLeft" align="right" valign="top"><a id="a25a1bb0d553ca66879253f21bc9e402c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#a25a1bb0d553ca66879253f21bc9e402c">begin</a> ()</td></tr>
<tr class="memdesc:a25a1bb0d553ca66879253f21bc9e402c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This must be called once after all the user callbacks have been set up. <br /></td></tr>
<tr class="separator:a25a1bb0d553ca66879253f21bc9e402c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8bad94cf8a6e9b6df5d4e8b07d8f5af"><td class="memItemLeft" align="right" valign="top"><a id="ad8bad94cf8a6e9b6df5d4e8b07d8f5af"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#ad8bad94cf8a6e9b6df5d4e8b07d8f5af">diagnostics</a> ()</td></tr>
<tr class="memdesc:ad8bad94cf8a6e9b6df5d4e8b07d8f5af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this periodicly to see the raw sensor readout values printed. <br /></td></tr>
<tr class="separator:ad8bad94cf8a6e9b6df5d4e8b07d8f5af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a96f97a4cf0146aa21265cc7b2068f2e1"><td class="memItemLeft" align="right" valign="top"><a id="a96f97a4cf0146aa21265cc7b2068f2e1"></a>
static constexpr int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#a96f97a4cf0146aa21265cc7b2068f2e1">dispatch_cycle_time_ms</a> = 100</td></tr>
<tr class="memdesc:a96f97a4cf0146aa21265cc7b2068f2e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure here the cycle time for the event loop/handler. <br /></td></tr>
<tr class="separator:a96f97a4cf0146aa21265cc7b2068f2e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91be570ff9174be97a3b096896bb6585"><td class="memItemLeft" align="right" valign="top"><a id="a91be570ff9174be97a3b096896bb6585"></a>
static constexpr int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_e_s_p32_touch.html#a91be570ff9174be97a3b096896bb6585">filter_period</a> = 10</td></tr>
<tr class="memdesc:a91be570ff9174be97a3b096896bb6585"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration for the ESP-IDF API IIR filter, higher values mean more stable results, but also more time lag. <br /></td></tr>
<tr class="separator:a91be570ff9174be97a3b096896bb6585"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ESP32 touch button driver with async callback interface. </p>
<p>This configures the hardware capacitive touch input pins on the Espressif ESP32 platform for up to ten non-multiplexed buttons.</p>
<p>All of the operation takes place asynchronously via user-defined callback functions, which can be any type compatible with a C++ std::function object, i.e. plain global functions, static an non-static class or instance members or C++11 lambda expressions.</p>
<p>In contrast to the original Arduino touchRead() function, this implementation works reliably with stable, filtered sensor readout and without false triggers by random spikes/zeros from some hardware or API failure (See: <a href="https://forum.arduino.cc/index.php?topic=629955.0">https://forum.arduino.cc/index.php?topic=629955.0</a>)</p>
<p>This API uses the ESP-IDF touch sensor interface, but does not register with the touch hardware ISR interface. Instead, this uses the continuous output from the ESP-IDF touch IIR filter using the filter_read_cb() hook from touch_pad.h. A freeRTOS timer (via Ticker.h) is then set up periodicly calling an event loop handler checking if any button threshold level is reached. If this is the case, it then calls the respective user callback. This has the advantage of not blocking the filter ISR for extended time.</p>
<p>The cycle time for the event checking loop can be configured in the header via dispatch_cycle_time_ms setting, the default is 100 milliseconds.</p>
<p>For the sensor input pins, please again note that the touch API uses a different numbering scheme than the standard GPIO numbers. E.g. touch button no. 0 is GPIO 4.</p>
<p>Repository at: <a href="https://github.com/ul-gh/ESP32Touch">https://github.com/ul-gh/ESP32Touch</a> 2020-02-25 Ulrich Lukas </p>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="esp32_touch_example_8cpp-example.html#_a0">esp32_touch_example.cpp</a>.</dd>
</dl></div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a3d6f0e4afbb6f98f753ec02d71bd4ec4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d6f0e4afbb6f98f753ec02d71bd4ec4">&#9670;&nbsp;</a></span>calibrate_thresholds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESP32Touch::calibrate_thresholds </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Force a sensor re-calibration. </p>
<p>This is called implicitly by <a class="el" href="class_e_s_p32_touch.html#a25a1bb0d553ca66879253f21bc9e402c" title="This must be called once after all the user callbacks have been set up. ">ESP32Touch::begin()</a>, but can be called later at run-time to do a re-calibration.</p>
<p>The touch buttons must not be pressed down while the calibration is running.. </p>

</div>
</div>
<a id="a4d71a331ef00f6853eb2285a0afd9763"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d71a331ef00f6853eb2285a0afd9763">&#9670;&nbsp;</a></span>configure_input()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESP32Touch::configure_input </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>input_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>threshold_percent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="esp32__touch_8hpp.html#a57055132e8b5e6931a9475fa451990ae">CallbackT</a>&#160;</td>
          <td class="paramname"><em>callback</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure input pin as a touch input, set threshold value and register the required user callback called when pin is touched. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input_number</td><td>Touch input pin number (!) different from GPIO numbering (!) </td></tr>
    <tr><td class="paramname">threshold_percent</td><td>Touch button touch detection threshold in percent of the calibration-time (i.e. idle-state) sensor readout value. </td></tr>
    <tr><td class="paramname">callback</td><td>User callback function, which can be any type compatible with a C++ std::function object, i.e. plain global functions, static an non-static class or instance members or C++11 lambda expressions. The callback must have a signature of void(void). </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="esp32_touch_example_8cpp-example.html#a1">esp32_touch_example.cpp</a>.</dd>
</dl>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="esp32__touch_8hpp_source.html">esp32_touch.hpp</a></li>
<li>src/esp32_touch.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
